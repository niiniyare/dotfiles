"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.GitHelper = void 0;

var _util = require("util");

var _child_process = require("child_process");

var _temp = require("temp");

var _ = require("./..");

const GitHelper = {
  IsRepoExist: async (path) => {
    if (_.UrlHelper.IsUrl(path)) {
      try {
        await (0, _util.promisify)(_child_process.exec)(`git ls-remote ${_.UrlHelper.GetGitUrl(path)}`);
        return {
          exists: true
        };
      } catch (e) {
        return {
          exists: false,
          error: "Source repository not found."
        };
      }
    }

    return {
      exists: false,
      error: "Source path not valid"
    };
  },
  CloneAndGetPath: async (path, branch) => {
    try {
      const tempInfo = await (0, _util.promisify)(_temp.mkdir)("");
      await (0, _util.promisify)(_child_process.exec)(`git clone --depth 1 ${branch ? `--branch ${branch}` : ""} ${_.UrlHelper.GetGitUrl(path)} "${tempInfo}"`);
      return tempInfo;
    } catch (e) {
      throw new Error(e instanceof Error ? e.message : e);
    }
  }
};
exports.GitHelper = GitHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9IZWxwZXIvZ2l0L2luZGV4LnRzIl0sIm5hbWVzIjpbIkdpdEhlbHBlciIsIklzUmVwb0V4aXN0IiwicGF0aCIsIlVybEhlbHBlciIsIklzVXJsIiwiZXhlYyIsIkdldEdpdFVybCIsImV4aXN0cyIsImUiLCJlcnJvciIsIkNsb25lQW5kR2V0UGF0aCIsImJyYW5jaCIsInRlbXBJbmZvIiwibWtkaXIiLCJFcnJvciIsIm1lc3NhZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFTyxNQUFNQSxTQUFTLEdBQUc7QUFDckJDLEVBQUFBLFdBQVcsRUFBRSxPQUNUQyxJQURTLEtBRXNDO0FBQy9DLFFBQUlDLFlBQVVDLEtBQVYsQ0FBZ0JGLElBQWhCLENBQUosRUFBMkI7QUFDdkIsVUFBSTtBQUNBLGNBQU0scUJBQVVHLG1CQUFWLEVBQ0QsaUJBQWdCRixZQUFVRyxTQUFWLENBQW9CSixJQUFwQixDQUEwQixFQUR6QyxDQUFOO0FBR0EsZUFBTztBQUFFSyxVQUFBQSxNQUFNLEVBQUU7QUFBVixTQUFQO0FBQ0gsT0FMRCxDQUtFLE9BQU9DLENBQVAsRUFBVTtBQUNSLGVBQU87QUFBRUQsVUFBQUEsTUFBTSxFQUFFLEtBQVY7QUFBaUJFLFVBQUFBLEtBQUssRUFBRTtBQUF4QixTQUFQO0FBQ0g7QUFDSjs7QUFDRCxXQUFPO0FBQUVGLE1BQUFBLE1BQU0sRUFBRSxLQUFWO0FBQWlCRSxNQUFBQSxLQUFLLEVBQUU7QUFBeEIsS0FBUDtBQUNILEdBZm9CO0FBZ0JyQkMsRUFBQUEsZUFBZSxFQUFFLE9BQU9SLElBQVAsRUFBcUJTLE1BQXJCLEtBQTBEO0FBQ3ZFLFFBQUk7QUFDQSxZQUFNQyxRQUFRLEdBQUcsTUFBTSxxQkFBVUMsV0FBVixFQUFpQixFQUFqQixDQUF2QjtBQUNBLFlBQU0scUJBQVVSLG1CQUFWLEVBQ0QsdUJBQ0dNLE1BQU0sR0FBSSxZQUFXQSxNQUFPLEVBQXRCLEdBQTBCLEVBQ25DLElBQUdSLFlBQVVHLFNBQVYsQ0FBb0JKLElBQXBCLENBQTBCLEtBQUlVLFFBQVMsR0FIekMsQ0FBTjtBQUtBLGFBQU9BLFFBQVA7QUFDSCxLQVJELENBUUUsT0FBT0osQ0FBUCxFQUFVO0FBQ1IsWUFBTSxJQUFJTSxLQUFKLENBQVVOLENBQUMsWUFBWU0sS0FBYixHQUFxQk4sQ0FBQyxDQUFDTyxPQUF2QixHQUFrQ1AsQ0FBNUMsQ0FBTjtBQUNIO0FBQ0o7QUE1Qm9CLENBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSBcInV0aWxcIjtcbmltcG9ydCB7IGV4ZWMgfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHsgbWtkaXIgfSBmcm9tIFwidGVtcFwiO1xuXG5pbXBvcnQgeyBVcmxIZWxwZXIgfSBmcm9tIFwiQEhlbHBlclwiO1xuXG5leHBvcnQgY29uc3QgR2l0SGVscGVyID0ge1xuICAgIElzUmVwb0V4aXN0OiBhc3luYyAoXG4gICAgICAgIHBhdGg6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPHsgZXhpc3RzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiA9PiB7XG4gICAgICAgIGlmIChVcmxIZWxwZXIuSXNVcmwocGF0aCkpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcHJvbWlzaWZ5KGV4ZWMpKFxuICAgICAgICAgICAgICAgICAgICBgZ2l0IGxzLXJlbW90ZSAke1VybEhlbHBlci5HZXRHaXRVcmwocGF0aCl9YCxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IGV4aXN0czogdHJ1ZSB9O1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UsIGVycm9yOiBcIlNvdXJjZSByZXBvc2l0b3J5IG5vdCBmb3VuZC5cIiB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UsIGVycm9yOiBcIlNvdXJjZSBwYXRoIG5vdCB2YWxpZFwiIH07XG4gICAgfSxcbiAgICBDbG9uZUFuZEdldFBhdGg6IGFzeW5jIChwYXRoOiBzdHJpbmcsIGJyYW5jaD86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB0ZW1wSW5mbyA9IGF3YWl0IHByb21pc2lmeShta2RpcikoXCJcIik7XG4gICAgICAgICAgICBhd2FpdCBwcm9taXNpZnkoZXhlYykoXG4gICAgICAgICAgICAgICAgYGdpdCBjbG9uZSAtLWRlcHRoIDEgJHtcbiAgICAgICAgICAgICAgICAgICAgYnJhbmNoID8gYC0tYnJhbmNoICR7YnJhbmNofWAgOiBcIlwiXG4gICAgICAgICAgICAgICAgfSAke1VybEhlbHBlci5HZXRHaXRVcmwocGF0aCl9IFwiJHt0ZW1wSW5mb31cImAsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHRlbXBJbmZvO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZSBpbnN0YW5jZW9mIEVycm9yID8gZS5tZXNzYWdlIDogKGUgYXMgc3RyaW5nKSk7XG4gICAgICAgIH1cbiAgICB9LFxufTtcbiJdfQ==