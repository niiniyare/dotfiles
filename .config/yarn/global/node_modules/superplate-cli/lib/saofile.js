"use strict";

var _path = _interopRequireDefault(require("path"));

var _validateNpmPackageName = _interopRequireDefault(require("validate-npm-package-name"));

var _child_process = require("child_process");

var _util = require("util");

var _chalk = _interopRequireDefault(require("chalk"));

var _uuid = require("uuid");

var _analyticsNode = _interopRequireDefault(require("analytics-node"));

var _Helper = require("./Helper");

var _process$env$SEGMENT_;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const analytics = new _analyticsNode.default((_process$env$SEGMENT_ = "dNsgapkYciyGCtTCySYcdHG7yTGI6IwV") !== null && _process$env$SEGMENT_ !== void 0 ? _process$env$SEGMENT_ : "");
const saoConfig = {
  prompts(sao) {
    var _sourcePrompts$prompt;

    const {
      appName,
      extras: {
        paths,
        presetAnswers
      }
    } = sao.opts; // eslint-disable-next-line @typescript-eslint/no-var-requires

    const sourcePrompts = require(_path.default.resolve(paths.sourcePath, "prompt.js"));

    const packageManagerChoices = (0, _Helper.get_potential_package_managers)();
    return [{
      type: "input",
      name: "name",
      message: "What would you like to name your project?:",
      default: appName,
      validate: name => {
        const appNameValidation = (0, _validateNpmPackageName.default)(name);

        if (appNameValidation.errors) {
          return false;
        }

        return true;
      }
    }, ...((_sourcePrompts$prompt = sourcePrompts === null || sourcePrompts === void 0 ? void 0 : sourcePrompts.prompts) !== null && _sourcePrompts$prompt !== void 0 ? _sourcePrompts$prompt : []).map(el => {
      var _presetAnswers$el$nam;

      return { ...el,
        default: (_presetAnswers$el$nam = presetAnswers === null || presetAnswers === void 0 ? void 0 : presetAnswers[el.name]) !== null && _presetAnswers$el$nam !== void 0 ? _presetAnswers$el$nam : el.default
      };
    }), {
      type: "select",
      name: "npmClient",
      message: "Choose a package manager:",
      choices: packageManagerChoices,
      default: packageManagerChoices.length === 1 ? packageManagerChoices[0].name : undefined,
      skip: () => packageManagerChoices.length === 1
    }];
  },

  data(sao) {
    /**
     * Package Manager
     */
    const {
      npmClient
    } = sao.answers;
    let pmRun = "npm run";

    if (npmClient === "yarn") {
      pmRun = "yarn";
    } else if (npmClient === "pnpm") {
      pmRun = "pnpm";
    }
    /**
     * Extend.js data
     */


    const {
      sourcePath
    } = sao.opts.extras.paths;
    const {
      projectType
    } = sao.opts.extras;
    const pluginAnswers = { ...sao.answers
    };
    delete pluginAnswers.name;
    const selectedPlugins = (0, _Helper.getPluginsArray)(pluginAnswers);
    const extendData = (0, _Helper.concatExtend)(_Helper.extendBase, selectedPlugins, sourcePath, sao.answers);
    /**
     * Plugins meta data
     */

    const pluginsData = (0, _Helper.mergePluginData)({}, sourcePath, selectedPlugins, "meta.json").plugins;
    const metaJSONPath = projectType === "react" ? "src/meta.json" : "public/meta.json";
    /**
     * Return
     */

    return { ...sao.answers,
      projectType,
      answers: sao.answers,
      selectedPlugins,
      pm: npmClient,
      pmRun,
      pluginsData,
      metaJSONPath,
      ...extendData
    };
  },

  async actions(sao) {
    if (sao.answers.name.length === 0) {
      const error = sao.createError("App name is required!");
      throw error;
    }

    const appNameValidation = (0, _validateNpmPackageName.default)(sao.answers.name);

    if (appNameValidation.warnings) {
      appNameValidation.warnings.forEach(warn => this.logger.warn(warn));
    }

    if (appNameValidation.errors) {
      appNameValidation.errors.forEach(warn => this.logger.error(warn));
      process.exit(1);
    }

    sao.opts.outDir = sao.answers.name;
    sao.opts.appName = sao.answers.name;
    const {
      sourcePath
    } = sao.opts.extras.paths;
    const actionsArray = [{
      type: "add",
      files: "**",
      templateDir: _path.default.join(sourcePath, "template"),

      data() {
        return sao.data;
      }

    }, {
      type: "move",
      templateDir: _path.default.join(sourcePath, "template"),
      patterns: {
        gitignore: ".gitignore",
        "_package.json": "package.json",
        "_next-env.d.ts": "next-env.d.ts",
        "_tsconfig.json": "tsconfig.json",
        babelrc: ".babelrc"
      },

      data() {
        return sao.data;
      }

    }];
    const pluginAnswers = { ...sao.answers
    };
    delete pluginAnswers.name;
    const selectedPlugins = (0, _Helper.getPluginsArray)(pluginAnswers); // eslint-disable-next-line @typescript-eslint/no-var-requires

    const sourcePrompts = require(_path.default.resolve(sourcePath, "prompt.js"));

    actionsArray.push(...selectedPlugins.map(plugin => {
      var _sourcePrompts$ignore;

      const customFilters = (0, _Helper.handleIgnore)((_sourcePrompts$ignore = sourcePrompts === null || sourcePrompts === void 0 ? void 0 : sourcePrompts.ignores) !== null && _sourcePrompts$ignore !== void 0 ? _sourcePrompts$ignore : [], sao.answers, plugin);
      return {
        type: "add",
        files: "**",
        templateDir: _path.default.join(sourcePath, "plugins", plugin),
        filters: {
          "extend.js": false,
          "package.json": false,
          "package.js": false,
          "tsconfig.json": false,
          ".babelrc": false,
          "meta.json": false,
          ...customFilters
        },

        data() {
          return sao.data;
        }

      };
    }));
    /**
     * eslintrc handler
     */

    actionsArray.push({
      type: "move",
      patterns: {
        "_.eslintrc": ".eslintrc"
      },

      data() {
        return sao.data;
      }

    });
    /**
     * meta.json handler
     */

    actionsArray.push({
      type: "modify",
      files: sao.data.metaJSONPath,

      handler(data) {
        return (0, _Helper.mergePluginData)(data, sourcePath, selectedPlugins, "meta.json");
      }

    });
    /**
     * package.json handler
     */

    actionsArray.push({
      type: "modify",
      files: "package.json",

      handler(data) {
        return (0, _Helper.mergePackages)(data, sourcePath, selectedPlugins, sao.answers);
      }

    });
    /**
     * tsconfig.json handler
     */

    actionsArray.push({
      type: "modify",
      files: "tsconfig.json",

      handler(data) {
        return (0, _Helper.mergeJSONFiles)(data, sourcePath, selectedPlugins, "tsconfig.json");
      }

    });
    /**
     * .babelrc handler
     */

    actionsArray.push({
      type: "modify",
      files: ".babelrc",

      async handler(data) {
        const merged = await (0, _Helper.mergeBabel)(JSON.parse(data), sourcePath, selectedPlugins);
        return JSON.stringify(merged);
      }

    });
    const {
      telemetry
    } = await (0, _Helper.prompt_telemetry)();

    if (telemetry === "yes") {
      analytics.track({
        event: "generate",
        properties: { ...sao.answers,
          type: sao.opts.extras.projectType
        },
        anonymousId: (0, _uuid.v4)()
      });
    }

    return actionsArray;
  },

  async prepare() {
    _Helper.tips.preInstall();
  },

  async completed(saoInstance) {
    var _saoInstance$opts$app;

    const {
      debug
    } = saoInstance.opts.extras;
    const {
      npmClient
    } = saoInstance.answers;
    /**
     * Git init and install packages
     */

    if (!debug) {
      saoInstance.gitInit();
      await saoInstance.npmInstall({
        npmClient: npmClient,
        installArgs: ["--silent"]
      });
    }
    /**
     * Format generated project
     */


    await (0, _util.promisify)(_child_process.exec)(`npx prettier "${saoInstance.outDir}" --write`);
    /**
     * Create an initial commit
     */

    if (!debug) {
      try {
        // add
        await (0, _util.promisify)(_child_process.exec)(`git --git-dir="${saoInstance.outDir}"/.git/ --work-tree="${saoInstance.outDir}"/ add -A`); // commit

        await (0, _util.promisify)(_child_process.exec)(`git --git-dir="${saoInstance.outDir}"/.git/ --work-tree="${saoInstance.outDir}"/ commit -m "initial commit with superplate"`);
        saoInstance.logger.info("created an initial commit.");
      } catch (_) {
        console.log(_chalk.default.yellow`An error occured while creating git commit.`);
      }
    }
    /**
     * Show messages after completion
     */


    _Helper.tips.postInstall({
      name: (_saoInstance$opts$app = saoInstance.opts.appName) !== null && _saoInstance$opts$app !== void 0 ? _saoInstance$opts$app : "",
      dir: saoInstance.outDir,
      pm: npmClient
    });
  }

};
module.exports = saoConfig;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zYW9maWxlLnRzIl0sIm5hbWVzIjpbImFuYWx5dGljcyIsIkFuYWx5dGljcyIsInNhb0NvbmZpZyIsInByb21wdHMiLCJzYW8iLCJhcHBOYW1lIiwiZXh0cmFzIiwicGF0aHMiLCJwcmVzZXRBbnN3ZXJzIiwib3B0cyIsInNvdXJjZVByb21wdHMiLCJyZXF1aXJlIiwicGF0aCIsInJlc29sdmUiLCJzb3VyY2VQYXRoIiwicGFja2FnZU1hbmFnZXJDaG9pY2VzIiwidHlwZSIsIm5hbWUiLCJtZXNzYWdlIiwiZGVmYXVsdCIsInZhbGlkYXRlIiwiYXBwTmFtZVZhbGlkYXRpb24iLCJlcnJvcnMiLCJtYXAiLCJlbCIsImNob2ljZXMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJza2lwIiwiZGF0YSIsIm5wbUNsaWVudCIsImFuc3dlcnMiLCJwbVJ1biIsInByb2plY3RUeXBlIiwicGx1Z2luQW5zd2VycyIsInNlbGVjdGVkUGx1Z2lucyIsImV4dGVuZERhdGEiLCJleHRlbmRCYXNlIiwicGx1Z2luc0RhdGEiLCJwbHVnaW5zIiwibWV0YUpTT05QYXRoIiwicG0iLCJhY3Rpb25zIiwiZXJyb3IiLCJjcmVhdGVFcnJvciIsIndhcm5pbmdzIiwiZm9yRWFjaCIsIndhcm4iLCJsb2dnZXIiLCJwcm9jZXNzIiwiZXhpdCIsIm91dERpciIsImFjdGlvbnNBcnJheSIsImZpbGVzIiwidGVtcGxhdGVEaXIiLCJqb2luIiwicGF0dGVybnMiLCJnaXRpZ25vcmUiLCJiYWJlbHJjIiwicHVzaCIsInBsdWdpbiIsImN1c3RvbUZpbHRlcnMiLCJpZ25vcmVzIiwiZmlsdGVycyIsImhhbmRsZXIiLCJtZXJnZWQiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ0ZWxlbWV0cnkiLCJ0cmFjayIsImV2ZW50IiwicHJvcGVydGllcyIsImFub255bW91c0lkIiwicHJlcGFyZSIsInRpcHMiLCJwcmVJbnN0YWxsIiwiY29tcGxldGVkIiwic2FvSW5zdGFuY2UiLCJkZWJ1ZyIsImdpdEluaXQiLCJucG1JbnN0YWxsIiwiaW5zdGFsbEFyZ3MiLCJleGVjIiwiaW5mbyIsIl8iLCJjb25zb2xlIiwibG9nIiwiY2hhbGsiLCJ5ZWxsb3ciLCJwb3N0SW5zdGFsbCIsImRpciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBSUE7Ozs7OztBQUhBLE1BQU1BLFNBQVMsR0FBRyxJQUFJQyxzQkFBSixxSUFBeUMsRUFBekMsQ0FBbEI7QUFtQkEsTUFBTUMsU0FBMEIsR0FBRztBQUMvQkMsRUFBQUEsT0FBTyxDQUFDQyxHQUFELEVBQU07QUFBQTs7QUFDVCxVQUFNO0FBQ0ZDLE1BQUFBLE9BREU7QUFFRkMsTUFBQUEsTUFBTSxFQUFFO0FBQUVDLFFBQUFBLEtBQUY7QUFBU0MsUUFBQUE7QUFBVDtBQUZOLFFBR0ZKLEdBQUcsQ0FBQ0ssSUFIUixDQURTLENBTVQ7O0FBQ0EsVUFBTUMsYUFBYSxHQUFHQyxPQUFPLENBQUNDLGNBQUtDLE9BQUwsQ0FDMUJOLEtBQUssQ0FBQ08sVUFEb0IsRUFFMUIsV0FGMEIsQ0FBRCxDQUE3Qjs7QUFLQSxVQUFNQyxxQkFBcUIsR0FBRyw2Q0FBOUI7QUFFQSxXQUFPLENBQ0g7QUFDSUMsTUFBQUEsSUFBSSxFQUFFLE9BRFY7QUFFSUMsTUFBQUEsSUFBSSxFQUFFLE1BRlY7QUFHSUMsTUFBQUEsT0FBTyxFQUFFLDRDQUhiO0FBSUlDLE1BQUFBLE9BQU8sRUFBRWQsT0FKYjtBQUtJZSxNQUFBQSxRQUFRLEVBQUdILElBQUQsSUFBa0I7QUFDeEIsY0FBTUksaUJBQWlCLEdBQUcscUNBQVNKLElBQVQsQ0FBMUI7O0FBRUEsWUFBSUksaUJBQWlCLENBQUNDLE1BQXRCLEVBQThCO0FBQzFCLGlCQUFPLEtBQVA7QUFDSDs7QUFFRCxlQUFPLElBQVA7QUFDSDtBQWJMLEtBREcsRUFnQkgsR0FBRywwQkFBQ1osYUFBRCxhQUFDQSxhQUFELHVCQUFDQSxhQUFhLENBQUVQLE9B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LEVBQUUsRUFBRVg7QUFIUyxLQUFqQjtBQUtIOztBQTdVOEIsQ0FBbkM7QUFnVkE4RCxNQUFNLENBQUNDLE9BQVAsR0FBaUIzRixTQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgdmFsaWRhdGUgZnJvbSBcInZhbGlkYXRlLW5wbS1wYWNrYWdlLW5hbWVcIjtcbmltcG9ydCB7IGV4ZWMgfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSBcInV0aWxcIjtcbmltcG9ydCBjaGFsayBmcm9tIFwiY2hhbGtcIjtcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gXCJ1dWlkXCI7XG5cbmltcG9ydCBBbmFseXRpY3MgZnJvbSBcImFuYWx5dGljcy1ub2RlXCI7XG5jb25zdCBhbmFseXRpY3MgPSBuZXcgQW5hbHl0aWNzKHByb2Nlc3MuZW52LlNFR01FTlRfS0VZID8/IFwiXCIpO1xuXG5pbXBvcnQgeyBHZW5lcmF0b3JDb25maWcsIEFjdGlvbiB9IGZyb20gXCIuLi9AdHlwZXMvc2FvXCI7XG5pbXBvcnQge1xuICAgIG1lcmdlUGFja2FnZXMsXG4gICAgY29uY2F0RXh0ZW5kLFxuICAgIGhhbmRsZUlnbm9yZSxcbiAgICBleHRlbmRCYXNlLFxuICAgIGdldFBsdWdpbnNBcnJheSxcbiAgICBtZXJnZUpTT05GaWxlcyxcbiAgICBtZXJnZUJhYmVsLFxuICAgIHRpcHMsXG4gICAgbWVyZ2VQbHVnaW5EYXRhLFxuICAgIHByb21wdF90ZWxlbWV0cnksXG4gICAgZ2V0X3BvdGVudGlhbF9wYWNrYWdlX21hbmFnZXJzLFxufSBmcm9tIFwiQEhlbHBlclwiO1xuXG5pbXBvcnQgeyBQcm9qZWN0UHJvbXB0IH0gZnJvbSBcIkBIZWxwZXIvbHVja3lcIjtcblxuY29uc3Qgc2FvQ29uZmlnOiBHZW5lcmF0b3JDb25maWcgPSB7XG4gICAgcHJvbXB0cyhzYW8pIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgYXBwTmFtZSxcbiAgICAgICAgICAgIGV4dHJhczogeyBwYXRocywgcHJlc2V0QW5zd2VycyB9LFxuICAgICAgICB9ID0gc2FvLm9wdHM7XG5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby12YXItcmVxdWlyZXNcbiAgICAgICAgY29uc3Qgc291cmNlUHJvbXB0cyA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgcGF0aHMuc291cmNlUGF0aCxcbiAgICAgICAgICAgIFwicHJvbXB0LmpzXCIsXG4gICAgICAgICkpO1xuXG4gICAgICAgIGNvbnN0IHBhY2thZ2VNYW5hZ2VyQ2hvaWNlcyA9IGdldF9wb3RlbnRpYWxfcGFja2FnZV9tYW5hZ2VycygpO1xuXG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJpbnB1dFwiLFxuICAgICAgICAgICAgICAgIG5hbWU6IFwibmFtZVwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBuYW1lIHlvdXIgcHJvamVjdD86XCIsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogYXBwTmFtZSxcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZTogKG5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhcHBOYW1lVmFsaWRhdGlvbiA9IHZhbGlkYXRlKG5hbWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcHBOYW1lVmFsaWRhdGlvbi5lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLi4uKHNvdXJjZVByb21wdHM/LnByb21wdHMgPz8gW10pLm1hcCgoZWw6IFByb2plY3RQcm9tcHQpID0+ICh7XG4gICAgICAgICAgICAgICAgLi4uZWwsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcHJlc2V0QW5zd2Vycz8uW2VsLm5hbWVdID8/IGVsLmRlZmF1bHQsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgICAgICAgICBuYW1lOiBcIm5wbUNsaWVudFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiQ2hvb3NlIGEgcGFja2FnZSBtYW5hZ2VyOlwiLFxuICAgICAgICAgICAgICAgIGNob2ljZXM6IHBhY2thZ2VNYW5hZ2VyQ2hvaWNlcyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBwYWNrYWdlTWFuYWdlckNob2ljZXMubGVuZ3RoID09PSAxXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHBhY2thZ2VNYW5hZ2VyQ2hvaWNlc1swXS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBza2lwOiAoKSA9PiBwYWNrYWdlTWFuYWdlckNob2ljZXMubGVuZ3RoID09PSAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXTtcbiAgICB9LFxuICAgIGRhdGEoc2FvKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQYWNrYWdlIE1hbmFnZXJcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IHsgbnBtQ2xpZW50IH0gPSBzYW8uYW5zd2VycztcblxuICAgICAgICBsZXQgcG1SdW4gPSBcIm5wbSBydW5cIjtcbiAgICAgICAgaWYgKG5wbUNsaWVudCA9PT0gXCJ5YXJuXCIpIHtcbiAgICAgICAgICAgIHBtUnVuID0gXCJ5YXJuXCI7XG4gICAgICAgIH0gZWxzZSBpZiAobnBtQ2xpZW50ID09PSBcInBucG1cIikge1xuICAgICAgICAgICAgcG1SdW4gPSBcInBucG1cIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFeHRlbmQuanMgZGF0YVxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgeyBzb3VyY2VQYXRoIH0gPSBzYW8ub3B0cy5leHRyYXMucGF0aHM7XG4gICAgICAgIGNvbnN0IHsgcHJvamVjdFR5cGUgfSA9IHNhby5vcHRzLmV4dHJhcztcblxuICAgICAgICBjb25zdCBwbHVnaW5BbnN3ZXJzID0geyAuLi5zYW8uYW5zd2VycyB9O1xuICAgICAgICBkZWxldGUgcGx1Z2luQW5zd2Vycy5uYW1lO1xuICAgICAgICBjb25zdCBzZWxlY3RlZFBsdWdpbnMgPSBnZXRQbHVnaW5zQXJyYXkocGx1Z2luQW5zd2Vycyk7XG4gICAgICAgIGNvbnN0IGV4dGVuZERhdGEgPSBjb25jYXRFeHRlbmQoXG4gICAgICAgICAgICBleHRlbmRCYXNlLFxuICAgICAgICAgICAgc2VsZWN0ZWRQbHVnaW5zLFxuICAgICAgICAgICAgc291cmNlUGF0aCxcbiAgICAgICAgICAgIHNhby5hbnN3ZXJzLFxuICAgICAgICApO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQbHVnaW5zIG1ldGEgZGF0YVxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgcGx1Z2luc0RhdGEgPSBtZXJnZVBsdWdpbkRhdGEoXG4gICAgICAgICAgICB7fSxcbiAgICAgICAgICAgIHNvdXJjZVBhdGgsXG4gICAgICAgICAgICBzZWxlY3RlZFBsdWdpbnMsXG4gICAgICAgICAgICBcIm1ldGEuanNvblwiLFxuICAgICAgICApLnBsdWdpbnM7XG5cbiAgICAgICAgY29uc3QgbWV0YUpTT05QYXRoID1cbiAgICAgICAgICAgIHByb2plY3RUeXBlID09PSBcInJlYWN0XCIgPyBcInNyYy9tZXRhLmpzb25cIiA6IFwicHVibGljL21ldGEuanNvblwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5zYW8uYW5zd2VycyxcbiAgICAgICAgICAgIHByb2plY3RUeXBlLFxuICAgICAgICAgICAgYW5zd2Vyczogc2FvLmFuc3dlcnMsXG4gICAgICAgICAgICBzZWxlY3RlZFBsdWdpbnMsXG4gICAgICAgICAgICBwbTogbnBtQ2xpZW50LFxuICAgICAgICAgICAgcG1SdW4sXG4gICAgICAgICAgICBwbHVnaW5zRGF0YSxcbiAgICAgICAgICAgIG1ldGFKU09OUGF0aCxcbiAgICAgICAgICAgIC4uLmV4dGVuZERhdGEsXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBhc3luYyBhY3Rpb25zKHNhbykge1xuICAgICAgICBpZiAoc2FvLmFuc3dlcnMubmFtZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gc2FvLmNyZWF0ZUVycm9yKFwiQXBwIG5hbWUgaXMgcmVxdWlyZWQhXCIpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhcHBOYW1lVmFsaWRhdGlvbiA9IHZhbGlkYXRlKHNhby5hbnN3ZXJzLm5hbWUpO1xuXG4gICAgICAgIGlmIChhcHBOYW1lVmFsaWRhdGlvbi53YXJuaW5ncykge1xuICAgICAgICAgICAgYXBwTmFtZVZhbGlkYXRpb24ud2FybmluZ3MuZm9yRWFjaCgod2FybikgPT5cbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKHdhcm4pLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhcHBOYW1lVmFsaWRhdGlvbi5lcnJvcnMpIHtcbiAgICAgICAgICAgIGFwcE5hbWVWYWxpZGF0aW9uLmVycm9ycy5mb3JFYWNoKCh3YXJuKSA9PiB0aGlzLmxvZ2dlci5lcnJvcih3YXJuKSk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgIH1cblxuICAgICAgICBzYW8ub3B0cy5vdXREaXIgPSBzYW8uYW5zd2Vycy5uYW1lO1xuICAgICAgICBzYW8ub3B0cy5hcHBOYW1lID0gc2FvLmFuc3dlcnMubmFtZTtcblxuICAgICAgICBjb25zdCB7IHNvdXJjZVBhdGggfSA9IHNhby5vcHRzLmV4dHJhcy5wYXRocztcblxuICAgICAgICBjb25zdCBhY3Rpb25zQXJyYXkgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJhZGRcIixcbiAgICAgICAgICAgICAgICBmaWxlczogXCIqKlwiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlRGlyOiBwYXRoLmpvaW4oc291cmNlUGF0aCwgXCJ0ZW1wbGF0ZVwiKSxcbiAgICAgICAgICAgICAgICBkYXRhKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2FvLmRhdGE7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJtb3ZlXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVEaXI6IHBhdGguam9pbihzb3VyY2VQYXRoLCBcInRlbXBsYXRlXCIpLFxuICAgICAgICAgICAgICAgIHBhdHRlcm5zOiB7XG4gICAgICAgICAgICAgICAgICAgIGdpdGlnbm9yZTogXCIuZ2l0aWdub3JlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiX3BhY2thZ2UuanNvblwiOiBcInBhY2thZ2UuanNvblwiLFxuICAgICAgICAgICAgICAgICAgICBcIl9uZXh0LWVudi5kLnRzXCI6IFwibmV4dC1lbnYuZC50c1wiLFxuICAgICAgICAgICAgICAgICAgICBcIl90c2NvbmZpZy5qc29uXCI6IFwidHNjb25maWcuanNvblwiLFxuICAgICAgICAgICAgICAgICAgICBiYWJlbHJjOiBcIi5iYWJlbHJjXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2FvLmRhdGE7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0gYXMgQWN0aW9uW107XG5cbiAgICAgICAgY29uc3QgcGx1Z2luQW5zd2VycyA9IHsgLi4uc2FvLmFuc3dlcnMgfTtcbiAgICAgICAgZGVsZXRlIHBsdWdpbkFuc3dlcnMubmFtZTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZFBsdWdpbnMgPSBnZXRQbHVnaW5zQXJyYXkocGx1Z2luQW5zd2Vycyk7XG5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby12YXItcmVxdWlyZXNcbiAgICAgICAgY29uc3Qgc291cmNlUHJvbXB0cyA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKHNvdXJjZVBhdGgsIFwicHJvbXB0LmpzXCIpKTtcblxuICAgICAgICBhY3Rpb25zQXJyYXkucHVzaChcbiAgICAgICAgICAgIC4uLnNlbGVjdGVkUGx1Z2lucy5tYXAoKHBsdWdpbjogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tRmlsdGVycyA9IGhhbmRsZUlnbm9yZShcbiAgICAgICAgICAgICAgICAgICAgc291cmNlUHJvbXB0cz8uaWdub3JlcyA/PyBbXSxcbiAgICAgICAgICAgICAgICAgICAgc2FvLmFuc3dlcnMsXG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbixcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJhZGRcIiBhcyBjb25zdCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZXM6IFwiKipcIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVEaXI6IHBhdGguam9pbihzb3VyY2VQYXRoLCBcInBsdWdpbnNcIiwgcGx1Z2luKSxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJleHRlbmQuanNcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBhY2thZ2UuanNvblwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGFja2FnZS5qc1wiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHNjb25maWcuanNvblwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiLmJhYmVscmNcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm1ldGEuanNvblwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmN1c3RvbUZpbHRlcnMsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2FvLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICApO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBlc2xpbnRyYyBoYW5kbGVyXG4gICAgICAgICAqL1xuICAgICAgICBhY3Rpb25zQXJyYXkucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiBcIm1vdmVcIiBhcyBjb25zdCxcbiAgICAgICAgICAgIHBhdHRlcm5zOiB7XG4gICAgICAgICAgICAgICAgXCJfLmVzbGludHJjXCI6IFwiLmVzbGludHJjXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2FvLmRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9IGFzIEFjdGlvbik7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIG1ldGEuanNvbiBoYW5kbGVyXG4gICAgICAgICAqL1xuICAgICAgICBhY3Rpb25zQXJyYXkucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiBcIm1vZGlmeVwiIGFzIGNvbnN0LFxuICAgICAgICAgICAgZmlsZXM6IHNhby5kYXRhLm1ldGFKU09OUGF0aCxcbiAgICAgICAgICAgIGhhbmRsZXIoZGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVyZ2VQbHVnaW5EYXRhKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFBsdWdpbnMsXG4gICAgICAgICAgICAgICAgICAgIFwibWV0YS5qc29uXCIsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBwYWNrYWdlLmpzb24gaGFuZGxlclxuICAgICAgICAgKi9cbiAgICAgICAgYWN0aW9uc0FycmF5LnB1c2goe1xuICAgICAgICAgICAgdHlwZTogXCJtb2RpZnlcIiBhcyBjb25zdCxcbiAgICAgICAgICAgIGZpbGVzOiBcInBhY2thZ2UuanNvblwiLFxuICAgICAgICAgICAgaGFuZGxlcihkYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXJnZVBhY2thZ2VzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFBsdWdpbnMsXG4gICAgICAgICAgICAgICAgICAgIHNhby5hbnN3ZXJzLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogdHNjb25maWcuanNvbiBoYW5kbGVyXG4gICAgICAgICAqL1xuICAgICAgICBhY3Rpb25zQXJyYXkucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiBcIm1vZGlmeVwiIGFzIGNvbnN0LFxuICAgICAgICAgICAgZmlsZXM6IFwidHNjb25maWcuanNvblwiLFxuICAgICAgICAgICAgaGFuZGxlcihkYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXJnZUpTT05GaWxlcyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRQbHVnaW5zLFxuICAgICAgICAgICAgICAgICAgICBcInRzY29uZmlnLmpzb25cIixcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIC5iYWJlbHJjIGhhbmRsZXJcbiAgICAgICAgICovXG4gICAgICAgIGFjdGlvbnNBcnJheS5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6IFwibW9kaWZ5XCIgYXMgY29uc3QsXG4gICAgICAgICAgICBmaWxlczogXCIuYmFiZWxyY1wiLFxuICAgICAgICAgICAgYXN5bmMgaGFuZGxlcihkYXRhOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXJnZWQgPSBhd2FpdCBtZXJnZUJhYmVsKFxuICAgICAgICAgICAgICAgICAgICBKU09OLnBhcnNlKGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VQYXRoLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFBsdWdpbnMsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobWVyZ2VkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHsgdGVsZW1ldHJ5IH0gPSBhd2FpdCBwcm9tcHRfdGVsZW1ldHJ5KCk7XG5cbiAgICAgICAgaWYgKHRlbGVtZXRyeSA9PT0gXCJ5ZXNcIikge1xuICAgICAgICAgICAgYW5hbHl0aWNzLnRyYWNrKHtcbiAgICAgICAgICAgICAgICBldmVudDogXCJnZW5lcmF0ZVwiLFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uc2FvLmFuc3dlcnMsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHNhby5vcHRzLmV4dHJhcy5wcm9qZWN0VHlwZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFub255bW91c0lkOiB1dWlkdjQoKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFjdGlvbnNBcnJheTtcbiAgICB9LFxuICAgIGFzeW5jIHByZXBhcmUoKSB7XG4gICAgICAgIHRpcHMucHJlSW5zdGFsbCgpO1xuICAgIH0sXG4gICAgYXN5bmMgY29tcGxldGVkKHNhb0luc3RhbmNlKSB7XG4gICAgICAgIGNvbnN0IHsgZGVidWcgfSA9IHNhb0luc3RhbmNlLm9wdHMuZXh0cmFzO1xuICAgICAgICBjb25zdCB7IG5wbUNsaWVudCB9ID0gc2FvSW5zdGFuY2UuYW5zd2VycztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdpdCBpbml0IGFuZCBpbnN0YWxsIHBhY2thZ2VzXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoIWRlYnVnKSB7XG4gICAgICAgICAgICBzYW9JbnN0YW5jZS5naXRJbml0KCk7XG4gICAgICAgICAgICBhd2FpdCBzYW9JbnN0YW5jZS5ucG1JbnN0YWxsKHtcbiAgICAgICAgICAgICAgICBucG1DbGllbnQ6IG5wbUNsaWVudCxcbiAgICAgICAgICAgICAgICBpbnN0YWxsQXJnczogW1wiLS1zaWxlbnRcIl0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGb3JtYXQgZ2VuZXJhdGVkIHByb2plY3RcbiAgICAgICAgICovXG4gICAgICAgIGF3YWl0IHByb21pc2lmeShleGVjKShgbnB4IHByZXR0aWVyIFwiJHtzYW9JbnN0YW5jZS5vdXREaXJ9XCIgLS13cml0ZWApO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYW4gaW5pdGlhbCBjb21taXRcbiAgICAgICAgICovXG4gICAgICAgIGlmICghZGVidWcpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gYWRkXG4gICAgICAgICAgICAgICAgYXdhaXQgcHJvbWlzaWZ5KGV4ZWMpKFxuICAgICAgICAgICAgICAgICAgICBgZ2l0IC0tZ2l0LWRpcj1cIiR7c2FvSW5zdGFuY2Uub3V0RGlyfVwiLy5naXQvIC0td29yay10cmVlPVwiJHtzYW9JbnN0YW5jZS5vdXREaXJ9XCIvIGFkZCAtQWAsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAvLyBjb21taXRcbiAgICAgICAgICAgICAgICBhd2FpdCBwcm9taXNpZnkoZXhlYykoXG4gICAgICAgICAgICAgICAgICAgIGBnaXQgLS1naXQtZGlyPVwiJHtzYW9JbnN0YW5jZS5vdXREaXJ9XCIvLmdpdC8gLS13b3JrLXRyZWU9XCIke3Nhb0luc3RhbmNlLm91dERpcn1cIi8gY29tbWl0IC1tIFwiaW5pdGlhbCBjb21taXQgd2l0aCBzdXBlcnBsYXRlXCJgLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgc2FvSW5zdGFuY2UubG9nZ2VyLmluZm8oXCJjcmVhdGVkIGFuIGluaXRpYWwgY29tbWl0LlwiKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgY2hhbGsueWVsbG93YEFuIGVycm9yIG9jY3VyZWQgd2hpbGUgY3JlYXRpbmcgZ2l0IGNvbW1pdC5gLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBtZXNzYWdlcyBhZnRlciBjb21wbGV0aW9uXG4gICAgICAgICAqL1xuICAgICAgICB0aXBzLnBvc3RJbnN0YWxsKHtcbiAgICAgICAgICAgIG5hbWU6IHNhb0luc3RhbmNlLm9wdHMuYXBwTmFtZSA/PyBcIlwiLFxuICAgICAgICAgICAgZGlyOiBzYW9JbnN0YW5jZS5vdXREaXIsXG4gICAgICAgICAgICBwbTogbnBtQ2xpZW50LFxuICAgICAgICB9KTtcbiAgICB9LFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBzYW9Db25maWc7XG4iXX0=